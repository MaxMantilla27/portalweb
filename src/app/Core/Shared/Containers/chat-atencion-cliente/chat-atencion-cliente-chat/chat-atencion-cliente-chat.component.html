<!-- holax1 -->
<div class="contentChat" >
  <div class="headerChatAula" >
    <div class="imgAsesor">
      <img [src]="img" (error)="ErrorImgAsesor()" alt="">
      <div class="nombreAsesor">
        <div *ngIf="nombreasesorglobal!=''" style="margin-left: 15px;">
          <div *ngIf="nombreasesorglobal!='Sin Asesor'">
            {{nombreAsesorSplit[0]}} {{nombreAsesorSplit[1]}}
          </div>
          <div *ngIf="nombreasesorglobal=='Sin Asesor'">
            Asesor Comercial
          </div>
          <div style="font-size: 14px;font-weight: 500;">
            BSG Institute
          </div>
        </div>
        <div *ngIf="nombreasesorglobal==''" style="text-align: center;">
          Chatea en línea
        </div>
      </div>
      <div class="stateAsesor" [ngClass]="{'OnConected': stateAsesor==true}">
      </div>
      <div style="width: 10%">
        <span
          style="width: 10%; cursor: pointer; font-weight: bold"
          (click)="Open = false; IsOpen.emit(false); toggleChat(false)"
          >-</span
        >
      </div>
    </div>
  </div>
  <ng-container *ngIf="estadoLogueo=='false';else login">
    <div style="border-left: 1px solid #FF4E56;border-right: 1px solid #FF4E56;padding:5px 0px 0px 1rem;">
      <div class="FlechaAtras no-select" (click)="onAtrasChatAtc()">
        <i class="material-icons">arrow_back_ios</i>
        <span>Atras</span>
      </div>
    </div>
    <app-form-chat-atc (SaveForm)="actualizarDatosAlumno($event)" [IdPGeneral]="idProgramageneral" [IdPespecificoPrograma]="IdPespecificoPrograma"></app-form-chat-atc>
  </ng-container>

  <ng-template #login>
    <ng-container *ngIf="nombreasesorglobal!='Sin Asesor'">
      <div class="FlechaAtrasMatricula no-select" (click)="showConfirmationDialog = true">
        <i class="material-icons">arrow_back_ios</i>
        <span>Atras</span>
      </div>
      <div *ngIf="showConfirmationDialog && !ReiniciarFlujoChat" class="confirmation-dialog-atras">
        <p>¿Deseas salir de esta sesión de chat? La conversación se dará por finalizada.</p>
        <button style="background: #ff8610;color:white" (click)="confirmAction()">Sí, retroceder</button>
        <button style="background: transparent;color:#033DAB;border: 1px solid #033DAB;"(click)="cancelAction()">Cancelar</button>
      </div>
      <div *ngIf="showConfirmationDialog && ReiniciarFlujoChat" class="confirmation-dialog-atras">
        <p>Tu sesión de chat se cerrará por inactividad. Gracias por conversar con nosotros. ¡Te esperamos nuevamente cuando lo necesites!</p>
        <button style="background: #ff8610;color:white" (click)="confirmActionReset()">Aceptar</button>
      </div>
      <div *ngIf="!showConfirmationDialog" #contenidoMsj class="contentChatMsj" (click)="marcarChatAgentecomoleido()">
        <div class="mensajeDefecto">Chat iniciado</div>
        <!-- <div class="mensajeDefecto">{{nombreAsesorSplit[0]}} {{nombreAsesorSplit[1]}} se unió al Chat</div> -->

        <ng-container *ngFor="let item of mensajesAnteriore;let i = index">
            <div  [ngClass]="{'visitanteMsj': item.idRemitente.toLowerCase()=='visitante','asesorMsj':item.idRemitente.toLowerCase()=='asesor'}">
              <div class="cntnmsj">
                <!-- <div class="remitente">{{item.NombreRemitente.split(' ')[0]}}</div> -->
                <div *ngIf="!item.esImagen" class="msj" [innerHtml]="item.mensaje | safeHtml"></div>
                <div class="msj">
                  <img
                    *ngIf="item.esImagen"
                    [src]="item.url"
                    alt="Imagen en el chat"
                    style="
                      max-width: 180px;
                      max-height: 80px;
                      width: auto;
                      height: auto;
                      cursor: pointer;
                    "
                    (click)="ampliarImagen(item.url)"
                  >
                </div>

                <div *ngFor="let pdfUrl of pdfsEnChat">
                  <iframe [src]="pdfUrl" width="100%" height="150px"></iframe>
                </div>
                <ng-container *ngIf="item.idRemitente.toLowerCase()=='visitante'">
                  <ng-container *ngIf="item.estadoEnviado==false">
                    <div class="statemsjEnviado">
                      <i class="material-icons">access_time</i>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="item.estadoEnviado!=false">
                    <!-- <ng-container  *ngIf="(mensajesAnteriore.length-i)>=NroMensajesSinLeer">
                      <div class="statemsjleido">
                        <i class="material-icons" style="right: 4px;
                        z-index: 3;">check</i>
                        <i class="material-icons" style="right: 1px;
                        z-index: 4;">check</i>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="(mensajesAnteriore.length-i)<NroMensajesSinLeer">
                      <div class="statemsjnoleido">
                        <i class="material-icons" style="right: 4px;
                        z-index: 3;">check</i>
                        <i class="material-icons" style="right: 1px;
                        z-index: 4;">check</i>
                      </div>
                    </ng-container> -->
                  </ng-container>

                </ng-container>

              </div>
              <div *ngIf="item.idRemitente.toLowerCase()!='visitante'" class="fecha-asesor">
                {{item.fechaEnvio}}
              </div>
              <div *ngIf="item.idRemitente.toLowerCase()=='visitante'" class="fecha-visitante">
                {{item.fechaEnvio}}
              </div>
            </div>
        </ng-container>

      </div>
      <div *ngIf="!showConfirmationDialog" class="footerChatAula" (click)="marcarChatAgentecomoleido()">
        <input class="chat-box-textinput" [ngClass]="{'inputActive':inputActive}" (keyup.enter)="enviarmsj()" (focus)="inputActive=true"
          (focusout)="inputActive=false" placeholder="Escribe tu mensaje aquí " [(ngModel)]="chatBox">
          <i class="material-icons" (click)="enviarmsj()">send</i>
          <i class="material-icons addfile" (click)="fileInput.click()">attach_file</i>
        <input  #fileInput type="file" style="display:none;" accept="image/png, image/gif, image/jpeg" (change)="AgregarArchivoChatSoporte($event)">
      </div>
    </ng-container>
    <ng-container *ngIf="nombreasesorglobal=='Sin Asesor'">
      <div style="border-left: 1px solid #FF4E56;border-right: 1px solid #FF4E56;padding:5px 0px 0px 1rem;">
        <div class="FlechaAtras no-select"  style="margin-left: 10px;" (click)="onAtrasChatAtcEnviado()">
          <i class="material-icons">arrow_back_ios</i>
          <span>Atras</span>
        </div>
      </div>
      <div class="PrimeraInteraccionAtcFondo">
        <div class="PrimeraInteraccionAtc" style="padding: 10px;font-size: 11px;">
          Un asesor se contactará contigo, gracias por tu preferencia.
        </div>
      </div>
    </ng-container>
  </ng-template>
</div>
